{% extends "main/index.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/categories.css' %}">
    <link rel="stylesheet" href="{% static 'css/summary-card.css' %}">
    <link rel="stylesheet" href="{% static 'css/list.css' %}">
    <link rel="stylesheet" href="{% static 'css/pagination.css' %}">
    <link rel="stylesheet" href="{% static 'css/filters.css' %}">
{% endblock %}

{% block content %}
    <div class="container mt-2">

        {% url 'category_update' category.id as edit_url %}
        {% include "components/header-with-back-to-category-button.html" with title=category_summary.name total=category_summary.transaction_amount edit_url=edit_url hide_back=True %}

        <div class="category-layout-stacked">

            <div class="category-list-section">
                <h2 class="section-title">
                    Transazioni Associate
                    <span class="badge-count">{{ category_summary.transaction_count }}</span>
                </h2>

                <!-- Filters for Associated Transactions -->
                <form method="get" class="filters mb-4"
                      hx-get="{% url 'category_detail' category.id %}"
                      hx-target="#category-detail-results"
                      hx-swap="outerHTML"
                      hx-indicator="#category-detail-results"
                      hx-trigger="change delay:500ms, submit"
                      id="transaction-filter-form">
                    <div class="filter-actions">
                        <button type="submit" class="btn btn-icon btn-subtle-primary" title="Filtra"><span class="material-icons">search</span></button>
                        <a hx-get="{% url 'category_detail' category.id %}"
                           hx-target="#category-detail-results"
                           hx-swap="outerHTML"
                           hx-indicator="#category-detail-results"
                           class="btn btn-icon btn-subtle-danger" title="Cancella"><span class="material-icons">clear</span></a>
                    </div>

                    <div class="filter-group w-100-mobile">
                        <label for="search"> Ricerca</label>
                        <input type="text" name="search" id="search" placeholder="Cerca merchant o descrizione..."
                               value="{{ search_query }}">
                    </div>

                    <div class="filter-group">
                        <label for="year"> Anno</label>
                        <select name="year" id="year">
                            <option value="">Tutti gli anni</option>
                            {% for available_year in available_years %}
                                <option value="{{ available_year }}" {% if available_year == selected_year %}selected{% endif %}>
                                    {{ available_year }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-group w-100-mobile">
                        <label for="months"> Mese/i</label>
                        <select name="months" id="months" multiple size="1">
                            <option value="">Tutti i mesi</option>
                            {% for month in available_months %}
                                <option value="{{ month.month_number }}"
                                        {% if month.month_number|stringformat:"s" in selected_months %}selected{% endif %}>
                                    {{ month.label_it }}
                                </option>
                            {% endfor %}
                        </select>
                        <small class="form-text text-muted desktop-only" style="font-size: 0.75rem; margin-top: 4px;">
                            Tieni premuto Ctrl (Windows) o Cmd (Mac) per selezionare pi√π mesi
                        </small>
                    </div>

                </form>

                {% include "categories/components/category_detail_results.html" %}
            </div>

        </div>
    </div>
{% endblock content %}