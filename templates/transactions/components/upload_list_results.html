{% load static %}
{% load time_filters %}
<div id="upload-results" hx-indicator="this">
    <div class="skeleton-loader">
        <div class="data-list uploaded-list-padding">
            {% for i in "12345" %}
                <div class="data-list-item" style="cursor: default; pointer-events: none;">
                    <div class="list-item-info">
                        <div class="skeleton-text" style="width: 250px; height: 18px; margin-bottom: 8px;"></div>
                        <div class="skeleton-text" style="width: 180px; height: 14px; margin-bottom: 4px;"></div>
                        <div class="skeleton-text" style="width: 120px; height: 14px;"></div>
                    </div>
                    <div class="list-item-stats">
                        <div class="skeleton-text" style="width: 100px; height: 24px; border-radius: 4px;"></div>
                        <div class="skeleton-text" style="width: 120px; height: 18px;"></div>
                        <div style="display: flex; gap: 8px;">
                            <div class="skeleton-text" style="width: 80px; height: 32px; border-radius: 4px;"></div>
                            <div class="skeleton-text" style="width: 80px; height: 32px; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <div class="hide-on-loading">
        <div class="data-list uploaded-list-padding">
        {% if uploads %}
            {% for upload in uploads %}
                <div class="data-list-item" onclick="window.location.href='{% url 'transactions_upload_detail' upload.id %}'">
                    <div class="list-item-info">
                        <div class="file-info-container">
                            <div class="file-text-content">
                                <div class="file-name">
                                    {% if upload.file_name %}{{ upload.file_name }}{% else %}{{ upload.id }}_{{ upload.upload_date|date:"Ymd_His" }}.csv{% endif %}
                                </div>
                                <div class="file-date">
                                     Caricato il {{ upload.upload_date|date:"d/m/Y H:i" }}
                                </div>
                                <div class="file-size text-muted">
                                    {% if upload.dimension %}
                                         {{ upload.file_size_display }}
                                    {% endif %}
                                    {% if upload.processing_time %}
                                         {{ upload.processing_time|format_processing_time }}
                                    {% else %}
                                        In corso
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="list-item-stats">
                        <span class="upload-status {% if upload.status != 'completed' %}status-pending{% else %}status-completato{% endif %}">
                            {% if upload.status != 'completed' %}
                            In corso
                            {% else %}
                            Completato
                            {% endif %}
                        </span>

                        <div class="expense-count">
                            <span class="count-number">{{ upload.transactions_count }}</span> Spese trovate
                        </div>
                        <div class="list-item-actions">
                            <button type="button" class="btn btn-outline-success btn-sm" onclick="exportUpload({{ upload.id }}, event)">
                                <span class="material-icons" style="font-size: 1.1em; vertical-align: middle; margin-right: 4px;">download</span> Esporta
                            </button>
                            <a href="{% url 'transactions_upload_delete' upload.id %}" class="btn btn-danger btn-sm" onclick="event.stopPropagation();">
                                Elimina
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p class="text-muted"> Nessun caricamento trovato. Carica il tuo primo file CSV!</p>
            </div>
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
        <div class="pagination mt-4">
            {% if page_obj.has_previous %}
                <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                   hx-get="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                   hx-target="#upload-results"
                   hx-swap="outerHTML"
                   hx-indicator="#upload-results"
                   class="pagination-link">&laquo; Prima</a>
                <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                   hx-get="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                   hx-target="#upload-results"
                   hx-swap="outerHTML"
                   hx-indicator="#upload-results"
                   class="pagination-link">Precedente</a>
            {% endif %}

            <span class="pagination-current">
                Pagina {{ page_obj.number }} di {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                   hx-get="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                   hx-target="#upload-results"
                   hx-swap="outerHTML"
                   hx-indicator="#upload-results"
                   class="pagination-link">Successiva</a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                   hx-get="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}"
                   hx-target="#upload-results"
                   hx-swap="outerHTML"
                   hx-indicator="#upload-results"
                   class="pagination-link">Ultima &raquo;</a>
            {% endif %}
        </div>
    {% endif %}
    </div>
</div>
