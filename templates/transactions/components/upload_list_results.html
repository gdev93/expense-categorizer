{% load static %}
{% load time_filters %}
<div id="upload-results" hx-indicator="this">
    <div class="skeleton-loader">
        <div class="data-list uploaded-list-padding">
            {% for i in "12345" %}
                <div class="data-list-item" style="cursor: default; pointer-events: none;">
                    <div class="list-item-info">
                        <div class="skeleton-text" style="width: 250px; height: 18px; margin-bottom: 8px;"></div>
                        <div class="skeleton-text" style="width: 180px; height: 14px; margin-bottom: 4px;"></div>
                        <div class="skeleton-text" style="width: 120px; height: 14px;"></div>
                    </div>
                    <div class="list-item-stats">
                        <div class="skeleton-text" style="width: 100px; height: 24px; border-radius: 4px;"></div>
                        <div class="skeleton-text desktop-only" style="width: 120px; height: 18px;"></div>
                        <div style="display: flex; gap: 8px;">
                            <div class="skeleton-text" style="width: 80px; height: 32px; border-radius: 4px;"></div>
                            <div class="skeleton-text" style="width: 80px; height: 32px; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <div class="hide-on-loading">
        <div class="data-list uploaded-list-padding">
        {% if uploads %}
            {% for upload in uploads %}
                <div class="data-list-item {% if upload.status != 'completed' %}item-pending{% endif %}" onclick="window.location.href='{% url 'transactions_upload_detail' upload.id %}'">
                    <div class="list-item-info">
                        <div class="file-info-container">
                            <div class="file-text-content">
                                {% if upload.status != 'completed' %}
                                    <div class="upload-status-label">
                                        <span class="material-icons spin-animation" style="font-size: 12px; vertical-align: middle; margin-right: 4px;">sync</span>
                                        In corso
                                    </div>
                                {% endif %}
                                <div class="file-name">
                                    {% if upload.file_name %}{{ upload.file_name }}{% else %}{{ upload.id }}_{{ upload.upload_date|date:"Ymd_His" }}{% endif %}
                                </div>
                                <div class="file-date">
                                     {{ upload.upload_date|date:"d/m/Y" }}
                                </div>
                                <div class="file-size text-muted">
                                    {% if upload.dimension %}
                                         {{ upload.file_size_display }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="list-item-stats">
                        {% if upload.status == 'completed' %}
                        {% endif %}

                        <div class="expense-count desktop-only">
                            <span class="count-number">{{ upload.transactions_count }}</span> Spese trovate
                        </div>
                        <div class="list-item-actions">
                            <button type="button" class="btn btn-icon btn-subtle" onclick="exportUpload({{ upload.id }}, event)" title="Esporta">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </button>
                            <a href="{% url 'transactions_upload_delete' upload.id %}" class="btn btn-icon btn-subtle-danger" title="Elimina" onclick="event.stopPropagation();">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 6h18"></path>
                                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            {% include "components/empty-state.html" with icon="upload_file" title="Nessun caricamento trovato" description="Carica il tuo primo file Excel o CSV per iniziare." %}
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
        <div class="pagination mt-4">
            {% if page_obj.has_previous %}
                <a href="?page=1&{{ request.GET.urlencode }}"
                   hx-get="?page=1&{{ request.GET.urlencode }}"
                   hx-target="#upload-results"
                   hx-swap="outerHTML settle:500ms"
                   hx-indicator="#upload-results"
                   class="pagination-link">&laquo; Prima</a>
                <a href="?page={{ page_obj.previous_page_number }}&{{ request.GET.urlencode }}"
                   hx-get="?page={{ page_obj.previous_page_number }}&{{ request.GET.urlencode }}"
                   hx-target="#upload-results"
                   hx-swap="outerHTML settle:500ms"
                   hx-indicator="#upload-results"
                   class="pagination-link">Precedente</a>
            {% endif %}

            <span class="pagination-current">
                Pagina {{ page_obj.number }} di {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode }}"
                   hx-get="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode }}"
                   hx-target="#upload-results"
                   hx-swap="outerHTML settle:500ms"
                   hx-indicator="#upload-results"
                   class="pagination-link">Successiva</a>
                <a href="?page={{ page_obj.paginator.num_pages }}&{{ request.GET.urlencode }}"
                   hx-get="?page={{ page_obj.paginator.num_pages }}&{{ request.GET.urlencode }}"
                   hx-target="#upload-results"
                   hx-swap="outerHTML settle:500ms"
                   hx-indicator="#upload-results"
                   class="pagination-link">Ultima &raquo;</a>
            {% endif %}
        </div>
    {% endif %}
    </div>
</div>
