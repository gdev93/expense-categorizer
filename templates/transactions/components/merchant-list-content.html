{% if uncategorized_merchants %}
<h2 class="mb-3">
     Spese Non Categorizzate
    <span class="badge"
          style="background-color: var(--category-bg); color: var(--category-text); border: 1px solid var(--category-border); padding: 4px 8px; border-radius: 12px; font-size: 14px;">
        {{ uncategorized_merchants.count }}
    </span>
</h2>
<details class="expander-card" style="margin-bottom: 40px;">
    <summary class="expander-header">
        <span style="font-weight: 600; color: #343a40;">Apri</span>
        <div class="expander-toggle-btn">
            <span class="expander-icon">â–¼</span>
        </div>
    </summary>

    <div class="expander-body">
        <div class="data-list">
            {% for item in uncategorized_merchants %}
                {% include "transactions/components/merchant-list-item.html" with item=item %}
            {% endfor %}
        </div>
    </div>
</details>
{% endif %}

{% if merchant_summary %}
    <div class="header-with-action mb-3">
        <h2 class="mb-0"> Spese Categorizzate</h2>
        <button class="btn btn-primary desktop-only" 
                onclick="window.location.href='{% url 'transaction_create' %}'">
            <span class="material-icons" style="vertical-align: middle; margin-right: 4px;">add_circle</span> Aggiungi Spesa
        </button>
        <button class="btn-fab mobile-only" 
                onclick="window.location.href='{% url 'transaction_create' %}'">
            <span class="material-icons">add</span>
        </button>
    </div>

    <div class="data-list" id="scroll-target">
        {% for item in merchant_summary %}
            {% include "transactions/components/merchant-list-item.html" with item=item %}
        {% endfor %}
    </div>

    {% if merchant_summary.has_other_pages %}
        <div class="pagination">
            {% if merchant_summary.has_previous %}
                <a href="?page={{ merchant_summary.previous_page_number }}&{{ request.GET.urlencode }}"
                   hx-get="?page={{ merchant_summary.previous_page_number }}&{{ request.GET.urlencode }}"
                   hx-target="#transaction-results"
                   hx-swap="outerHTML settle:500ms"
                   hx-indicator="#transaction-results">&laquo; Precedente</a>
            {% else %}
                <span class="disabled">&laquo; Precedente</span>
            {% endif %}

            <span class="current">
                Pagina {{ merchant_summary.number }} di {{ merchant_summary.paginator.num_pages }}
            </span>

            {% if merchant_summary.has_next %}
                <a href="?page={{ merchant_summary.next_page_number }}&{{ request.GET.urlencode }}"
                   hx-get="?page={{ merchant_summary.next_page_number }}&{{ request.GET.urlencode }}"
                   hx-target="#transaction-results"
                   hx-swap="outerHTML settle:500ms"
                   hx-indicator="#transaction-results">Successivo &raquo;</a>
            {% else %}
                <span class="disabled">Successivo &raquo;</span>
            {% endif %}
        </div>
    {% endif %}
{% elif not uncategorized_merchants %}
    <!-- Empty State for Merchant View -->
    {% include "components/empty-state.html" with icon="store" title="Nessuna Transazione Trovata" description="Non ci sono transazioni che corrispondono ai filtri selezionati." %}
{% endif %}
